<script>
  function loadProducts() {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const list = document.getElementById('product-list');
    list.innerHTML = '';

    if (products.length === 0) {
      list.innerHTML = '<p style="text-align:center;">No products added yet.</p>';
      return;
    }

    products.forEach((p, index) => {
      const imagesHTML = (p.images || [p.image || 'images/default.jpg'])
        .map(img => `<img src="${img}" alt="${p.name}">`)
        .join('');

      list.innerHTML += `
        <div class="product-card" id="product-${index}">
          <div class="product-info">
            <strong>${p.name}</strong><br>
            Price: ‚Çπ${p.price}<br>
            Stock: ${p.stock || 0}
          </div>
          <div class="product-images">${imagesHTML}</div>
          <div class="actions">
            <button onclick="editProduct(${index})">‚úèÔ∏è Edit</button>
            <button onclick="deleteProduct(${index})" style="background:red;">üóëÔ∏è Delete</button>
          </div>
        </div>
      `;
    });
  }

  function saveProduct() {
    const name = document.getElementById('product-name').value.trim();
    const price = parseInt(document.getElementById('product-price').value);
    const stock = parseInt(document.getElementById('product-stock').value);
    const img1 = document.getElementById('product-image1').files[0];
    const img2 = document.getElementById('product-image2').files[0];
    const img3 = document.getElementById('product-image3').files[0];
    const editIndex = document.getElementById('edit-index').value;

    if (!name || !price || !stock) {
      alert("Please fill all fields!");
      return;
    }

    const products = JSON.parse(localStorage.getItem('products')) || [];

    let imageUrls = [];

    // üîπ If editing, keep old images unless new ones are uploaded
    if (editIndex !== "") {
      imageUrls = products[editIndex].images || [];
    }

    // üîπ Update or add new image slots only if a new file is uploaded
    if (img1) imageUrls[0] = URL.createObjectURL(img1);
    if (img2) imageUrls[1] = URL.createObjectURL(img2);
    if (img3) imageUrls[2] = URL.createObjectURL(img3);

    // üîπ Make sure at least one image exists (default fallback)
    if (imageUrls.length === 0) {
      imageUrls.push('images/default.jpg');
    }

    const productData = { name, price, stock, images: imageUrls };

    if (editIndex !== "") {
      products[editIndex] = productData;
      alert("‚úÖ Product updated successfully!");
      document.getElementById('edit-index').value = "";
    } else {
      products.push(productData);
      alert("‚úÖ Product added successfully!");
    }

    localStorage.setItem('products', JSON.stringify(products));
    resetForm();
    loadProducts();
  }

  function editProduct(index) {
    const products = JSON.parse(localStorage.getItem('products')) || [];
    const p = products[index];
    document.getElementById('product-name').value = p.name;
    document.getElementById('product-price').value = p.price;
    document.getElementById('product-stock').value = p.stock || 0;
    document.getElementById('edit-index').value = index;

    document.querySelectorAll('.product-card').forEach(card => card.classList.remove('edit-mode'));
    document.getElementById(`product-${index}`).classList.add('edit-mode');
  }

  function deleteProduct(index) {
    if (!confirm("Are you sure you want to delete this product?")) return;
    const products = JSON.parse(localStorage.getItem('products')) || [];
    products.splice(index, 1);
    localStorage.setItem('products', JSON.stringify(products));
    loadProducts();
  }

  function resetForm() {
    document.getElementById('product-name').value = "";
    document.getElementById('product-price').value = "";
    document.getElementById('product-stock').value = "";
    document.getElementById('product-image1').value = "";
    document.getElementById('product-image2').value = "";
    document.getElementById('product-image3').value = "";
    document.getElementById('edit-index').value = "";
  }

  window.onload = loadProducts;
</script>
